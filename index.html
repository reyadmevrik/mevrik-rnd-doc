<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Protected Document Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #525252;
        min-height: 100vh;
      }

      /* Login Screen */
      .login-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 20px;
      }

      .login-container {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 60px 40px;
        max-width: 450px;
        width: 100%;
        text-align: center;
      }

      .lock-icon {
        width: 120px;
        height: 120px;
        margin: 0 auto 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .lock-icon img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      h1 {
        color: #2d3748;
        font-size: 28px;
        margin-bottom: 12px;
        font-weight: 700;
      }

      .subtitle {
        color: #718096;
        margin-bottom: 40px;
        font-size: 15px;
      }

      .input-group {
        position: relative;
        margin-bottom: 24px;
      }

      input[type="password"] {
        width: 100%;
        padding: 16px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.3s ease;
        outline: none;
      }

      input[type="password"]:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      button {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      button:active {
        transform: translateY(0);
      }

      .error-message {
        background: #fee;
        color: #c53030;
        padding: 12px 16px;
        border-radius: 8px;
        margin-top: 16px;
        font-size: 14px;
        display: none;
        animation: shake 0.4s ease;
      }

      .error-message.show {
        display: block;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      /* File Selection Screen */
      .file-selection {
        display: none;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 60px 20px;
        text-align: center;
      }

      .file-selection h2 {
        font-size: 28px;
        margin-bottom: 30px;
      }

      .file-list {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
      }

      .file-card {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        padding: 20px;
        width: 200px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .file-card:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-4px);
      }

      .file-card h3 {
        font-size: 18px;
        margin-bottom: 8px;
      }

      .file-card p {
        font-size: 14px;
        color: #e2e8f0;
      }

      /* Loading Screen */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .loading-content {
        text-align: center;
        color: white;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Viewer */
      .viewer-wrapper {
        display: none;
        min-height: 100vh;
      }

      .viewer-header {
        position: sticky;
        top: 0;
        background: #2d3748;
        color: white;
        padding: 16px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 12px;
        z-index: 100;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .viewer-title {
        font-size: 18px;
        font-weight: 600;
      }

      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }

      .control-btn {
        padding: 8px 16px;
        background: #4a5568;
        border: none;
        color: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.2s ease;
      }

      .control-btn:hover {
        background: #5a6778;
      }

      .page-info {
        color: #e2e8f0;
        font-size: 14px;
        padding: 0 8px;
      }

      .pdf-container {
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        background: #525252;
      }

      .pdf-page {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        background: white;
        max-width: 100%;
      }

      .footer {
        background: #2d3748;
        padding: 16px 24px;
        text-align: center;
        color: #a0aec0;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div id="login" class="login-overlay">
      <div class="login-container">
        <div class="lock-icon">
          <img
            src="https://mevrik-cloud.mevrik.com/apps_15/LB6WV-15_8DXT_mevrik-logo-1-.png"
            alt="Mevrik Logo"
          />
        </div>
        <h1>Mevrik Document</h1>
        <p class="subtitle">Enter password to view documents</p>
        <form id="password-form">
          <div class="input-group">
            <input
              type="password"
              id="password-input"
              placeholder="Enter password"
              autocomplete="off"
              required
            />
          </div>
          <button type="submit">Unlock</button>
          <div id="error-message" class="error-message"></div>
        </form>
      </div>
    </div>

    <!-- File Selection Screen -->
    <div id="file-selection" class="file-selection">
      <h2>Select a Document to View</h2>
      <div class="file-list" id="file-list"></div>
    </div>

    <!-- Loading Screen -->
    <div id="loading" class="loading-overlay">
      <div class="loading-content">
        <div class="spinner"></div>
        <p>Decrypting and loading document...</p>
      </div>
    </div>

    <!-- Viewer -->
    <div id="viewer" class="viewer-wrapper">
      <div class="viewer-header">
        <div class="viewer-title" id="viewer-title">üìÑ Mevrik Viewer</div>
        <div class="controls">
          <span class="page-info">
            Page <span id="current-page">1</span> of
            <span id="total-pages">-</span>
          </span>
          <button class="control-btn" id="zoom-out">Zoom ‚àí</button>
          <button class="control-btn" id="zoom-in">Zoom +</button>
          <button class="control-btn" id="fit-width">Fit Width</button>
        </div>
      </div>
      <div id="pdf-container" class="pdf-container"></div>
      <div class="footer">üîê Protected Document Viewer ‚Äî ¬© Mevrik</div>
    </div>

    <script>
      const CONFIG = {
        correctPasswordHash:
          "18be59f72c23c94957077bd3d1ca4e05ddd4d89459fa6123809c64c70c4371fa",
        files: [
          { name: "Mevrik CX AI RnD Doc V-1.3.0", file: "rnd-document.pdf.enc" },
          { name: "AI Agent Architecture", file: "#" },
          { name: "Customer Journey Map", file: "#" },
          { name: "Mevrik CX AI RnD Doc V-1.3.0", file: "rnd-document.pdf.enc" },
          { name: "AI Agent Architecture", file: "#" },
          { name: "Customer Journey Map", file: "#" },
        ],
      };

      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

      let pdfDoc = null;
      let scale = 1.5;
      let password = "";

      const loginScreen = document.getElementById("login");
      const fileSelection = document.getElementById("file-selection");
      const viewerScreen = document.getElementById("viewer");
      const loadingScreen = document.getElementById("loading");
      const pdfContainer = document.getElementById("pdf-container");
      const errorMessage = document.getElementById("error-message");

      function hashPassword(password) {
        return CryptoJS.SHA256(password).toString();
      }

      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.classList.add("show");
        setTimeout(() => errorMessage.classList.remove("show"), 3000);
      }

      function showFileList() {
        loginScreen.style.display = "none";
        fileSelection.style.display = "block";

        const list = document.getElementById("file-list");
        list.innerHTML = "";
        CONFIG.files.forEach((f) => {
          const div = document.createElement("div");
          div.className = "file-card";
          div.innerHTML = `<h3>${f.name}</h3><p>Encrypted PDF</p>`;
          div.addEventListener("click", () => loadPDF(f));
          list.appendChild(div);
        });
      }

      async function loadPDF(fileInfo) {
        fileSelection.style.display = "none";
        loadingScreen.style.display = "flex";

        try {
          const res = await fetch(fileInfo.file);
          if (!res.ok) throw new Error("File not found");
          const encrypted = await res.text();
          const decrypted = CryptoJS.AES.decrypt(encrypted, password).toString(
            CryptoJS.enc.Utf8
          );
          if (!decrypted) throw new Error("Decryption failed");

          const binary = atob(decrypted);
          const bytes = new Uint8Array(binary.length);
          for (let i = 0; i < binary.length; i++)
            bytes[i] = binary.charCodeAt(i);

          pdfDoc = await pdfjsLib.getDocument({ data: bytes }).promise;
          document.getElementById("total-pages").textContent = pdfDoc.numPages;
          document.getElementById("viewer-title").textContent =
            "üìÑ " + fileInfo.name;
          viewerScreen.style.display = "block";
          loadingScreen.style.display = "none";
          renderAllPages();
        } catch (err) {
          console.error(err);
          loadingScreen.style.display = "none";
          showError("Failed to load or decrypt the file.");
          fileSelection.style.display = "block";
        }
      }

      async function renderAllPages() {
        pdfContainer.innerHTML = "";
        for (let i = 1; i <= pdfDoc.numPages; i++) {
          const page = await pdfDoc.getPage(i);
          const viewport = page.getViewport({ scale });
          const canvas = document.createElement("canvas");
          canvas.className = "pdf-page";
          const ctx = canvas.getContext("2d");
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          await page.render({ canvasContext: ctx, viewport }).promise;
          pdfContainer.appendChild(canvas);
        }
      }

      document
        .getElementById("password-form")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          const input = document.getElementById("password-input").value;
          const hash = hashPassword(input);
          if (hash === CONFIG.correctPasswordHash) {
            password = input;
            showFileList();
          } else {
            showError("Incorrect password.");
          }
        });

      document.getElementById("zoom-in").addEventListener("click", () => {
        scale += 0.2;
        renderAllPages();
      });

      document.getElementById("zoom-out").addEventListener("click", () => {
        scale = Math.max(0.5, scale - 0.2);
        renderAllPages();
      });

      document.getElementById("fit-width").addEventListener("click", async () => {
        const containerWidth = pdfContainer.offsetWidth - 40;
        const page = await pdfDoc.getPage(1);
        const viewport = page.getViewport({ scale: 1 });
        scale = containerWidth / viewport.width;
        renderAllPages();
      });
    </script>
  </body>
</html>
